//###############################################################################
//# WbXbc - Manual - Plain Crossbar Switch                                      #
//###############################################################################
//#    Copyright 2018 Dirk Heisswolf                                            #
//#    This file is part of the WbXbc project.                                  #
//#                                                                             #
//#    WbXbc is free software: you can redistribute it and/or modify            #
//#    it under the terms of the GNU General Public License as published by     #
//#    the Free Software Foundation, either version 3 of the License, or        #
//#    (at your option) any later version.                                      #
//#                                                                             #
//#    WbXbc is distributed in the hope that it will be useful,                 #
//#    but WITHOUT ANY WARRANTY; without even the implied warranty of           #
//#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the            #
//#    GNU General Public License for more details.                             #
//#                                                                             #
//#    You should have received a copy of the GNU General Public License        #
//#    along with WbXbc.  If not, see <http://www.gnu.org/licenses/>.           #
//###############################################################################
//# Version History:                                                            #
//#   August 10, 2018                                                           #
//#      - Initial release                                                      #
//###############################################################################

== WbXbc Xbar

[ditaa, WbXbc_xbar, svg]
....
      Initiator         Initiator            Initiator   
          |                 |      . . .        |    
          V                 V                   V    
 +----------------------------------------------------------------------+
 |        |                 |                   |                       | 
 |        V                 V                   V                       |
 |  +-----------+     +-----------+       +-----------+                 |
 |  |WbXbc      |     |WbXbc      |       |WbXbc      |                 |
 |  |Distributor|     |Distributor| . . . |Distributor|                 |
 |  +-+-+-----+-+     +-+-+-----+-+       +-+-+-----+-+                 |
 |    | | ... |         | | ... |           | | ... |                   |
 |    | |     |         | |     |           | |     |                   |
 |    | |     |         | |     |           | |     |     +---------+   |       
 |    +-|-----|---------|-|-----|-----------|-|-----|---->|         |   |       
 |      |     |         +-|---- |-----------|-|-----|---->| WbXbc   +-->|-->Target
 |      |     |           |     |           | |     | ... | Arbiter |   |       
 |      |     |           |     |           +-|-----|---->|         |   |       
 |      |     |           |     |             |     |     +---------+   |       
 |      |     |           |     |             |     |                   |       
 |      |     |           |     |             |     |     +---------+   |       
 |      +-----|-----------|-----|-------------|-----|---->|         |   |       
 |            |           +-----|-------------|-----|---->| WbXbc   +-->|-->Target
 |            |                 |             |     | ... | Arbiter |   |       
 |            |                 |             +-----|---->|         |   |       
 |            |                 |                   |     +---------+   |       
 |            |                 |                   |                   |       
 |            |                 |                   |        . . .      |   . . .       
 |            |                 |                   |                   |       
 |            |                 |                   |     +---------+   |       
 |            +-----------------|-------------------|---->|         |   |       
 |                              +-------------------|---->| WbXbc   +-->|-->Target
 |                                                  | ... | Arbiter |   |       
 |     WbXbc                                        +---->|         |   |       
 |     Xbar                                               +---------+   |  
 |                                                                      |
 +----------------------------------------------------------------------+
....

This module implements a full crossbar switch between a set of initator
busses and a set of target busses, all using the pipelined Wishbone    
protocol.                                                              

=== Integration Parameters
[cols="30,20,50",options="header"]
|=====================================================
|Parameter   |Default Value |Description
|ITR_CNT    >|4             |number of initiator busses
|TGT_CNT    >|4             |number of target busses
|ADDR_WIDTH >|16            |width of the address bus
|DATA_WIDTH >|16            |width of each data bus
|SEL_WIDTH  >|2             |number of data select lines
|TGA_WIDTH  >|1             |number of address tags
|TGC_WIDTH  >|1             |number of cycle tags
|TGRD_WIDTH >|1             |number of read data tags
|TGWD_WIDTH >|1             |number of write data tags
|=====================================================

Section <<parameters>> gives a detailed description of each parameter listed above.

//[cols="6,2,2,10v",options="header"]


=== Interface Signals
[cols="20,35,15,30v",options="header"]
|=====================================================
|Signal   |Range |Direction |Description
4+h|Clock and Reset
|clk_i             >|                         |input  |module clock	
|async_rst_i       >|                         |input  |asynchronous reset	
|sync_rst_i        >|                         |input  |synchronous reset  
4+h|Target Address Regions
|region_addr       >|(TGT_CNT*ADDR_WIDTH)-1:0 |input  |target address
|region_mask       >|(TGT_CNT*ADDR_WIDTH)-1:0 |input  |selects relevant address bits
4+h|Initiator Interface
|itr_cyc_i         >|ITR_CNT-1:0              |input  |concatinated bus cycle indicators
|itr_stb_i         >|ITR_CNT-1:0              |input  |concatinated access requests
|itr_we_i          >|ITR_CNT-1:0              |input  |concatinated write enables
|itr_lock_i        >|ITR_CNT-1:0              |input  |concatinated bus cycle locks
|itr_sel_i         >|(ITR_CNT*SEL_WIDTH)-1:0  |input  |concatinated write data selects
|itr_adr_i         >|(ITR_CNT*ADDR_WIDTH)-1:0 |input  |concatinated address busses
|itr_dat_i         >|(ITR_CNT*DATA_WIDTH)-1:0 |input  |concatinated write data busses
|itr_tga_i         >|(ITR_CNT*TGA_WIDTH)-1:0  |input  |concatinated address tags
|itr_tga_prio_i    >|ITR_CNT-1:0              |input  |concatinated access priorities
|itr_tgc_i         >|(ITR_CNT*TGC_WIDTH)-1:0  |input  |concatinated bus cycle tags
|itr_tgd_i         >|(ITR_CNT*TGWD_WIDTH)-1:0 |input  |concatinated write data tags
|itr_ack_o         >|ITR_CNT-1:0              |output |concatinated bus cycle acknowledges
|itr_err_o         >|ITR_CNT-1:0              |output |concatinated error indicators
|itr_rty_o         >|ITR_CNT-1:0              |output |concatinated retry requests
|itr_stall_o       >|ITR_CNT-1:0              |output |concatinated access delays
|itr_dat_o         >|(ITR_CNT*DATA_WIDTH)-1:0 |output |concatinated read data buses
|itr_tgd_o         >|(ITR_CNT*TGRD_WIDTH)-1:0 |output |concatinated read data tags
4+h|Target Interfaces
|tgt_cyc_o         >|TGT_CNT-1:0              |output |concatinated bus cycle indicators
|tgt_stb_o         >|TGT_CNT-1:0              |output |concatinated access requests
|tgt_we_o          >|TGT_CNT-1:0              |output |concatinated write enables
|tgt_lock_o        >|TGT_CNT-1:0              |output |concatinated bus cycle locks
|tgt_sel_o         >|(TGT_CNT*SEL_WIDTH)-1:0  |output |concatinated write data selects
|tgt_adr_o         >|(TGT_CNT*ADDR_WIDTH)-1:0 |output |concatinated write data selects
|tgt_dat_o         >|(TGT_CNT*DATA_WIDTH)-1:0 |output |concatinated write data busses
|tgt_tga_o         >|(TGT_CNT*TGA_WIDTH)-1:0  |output |concatinated address tags
|tgt_tgc_o         >|(TGT_CNT*TGC_WIDTH)-1:0  |output |concatinated bus cycle tags
|tgt_tgd_o         >|(TGT_CNT*TGWD_WIDTH)-1:0 |output |concatinated write data tags
|tgt_ack_i         >|TGT_CNT-1:0              |input  |concatinated bus cycle acknowledges
|tgt_err_i         >|TGT_CNT-1:0              |input  |concatinated error indicators
|tgt_rty_i         >|TGT_CNT-1:0              |input  |concatinated retry requests
|tgt_stall_i       >|TGT_CNT-1:0              |input  |concatinated access delays
|tgt_dat_i         >|(TGT_CNT*DATA_WIDTH)-1:0 |input  |concatinated read data busses
|tgt_tgd_i         >|(TGT_CNT*TGRD_WIDTH)-1:0 |input  |concatinated read data tags
|=====================================================

Section <<signals>> gives a detailed description of each slignal listed above.

=== Verification Status
[cols="16v,>4,4*20v",options="header"]
|=====================================================
2+<|Configuration <|Linting <|Simulation <|Formal <|FPGA
//Default configuration
6+h|Default Configuration
|ITR_CNT    >|4
//Liniting
.9+^.^| iVerilog,
Yosys
//Simulation
.9+^.^|
//Formal
.9+^.^|
//FPGA
.9+^.^|          
|TGT_CNT    >|4
|ADDR_WIDTH >|16            
|DATA_WIDTH >|16             
|SEL_WIDTH  >|2             
|TGA_WIDTH  >|1             
|TGC_WIDTH  >|1             
|TGRD_WIDTH >|1             
|TGWD_WIDTH >|1             
|=====================================================

All lint checks have been done with the Icarus Verilog simulator cite:[IVerilog]
and the Yosys synthesis tool cite:[Yosys].

