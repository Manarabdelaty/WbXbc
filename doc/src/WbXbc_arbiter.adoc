//###############################################################################
//# WbXbc - Manual - Bus Arbiter                                                #
//###############################################################################
//#    Copyright 2018 Dirk Heisswolf                                            #
//#    This file is part of the WbXbc project.                                  #
//#                                                                             #
//#    WbXbc is free software: you can redistribute it and/or modify            #
//#    it under the terms of the GNU General Public License as published by     #
//#    the Free Software Foundation, either version 3 of the License, or        #
//#    (at your option) any later version.                                      #
//#                                                                             #
//#    WbXbc is distributed in the hope that it will be useful,                 #
//#    but WITHOUT ANY WARRANTY; without even the implied warranty of           #
//#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the            #
//#    GNU General Public License for more details.                             #
//#                                                                             #
//#    You should have received a copy of the GNU General Public License        #
//#    along with WbXbc.  If not, see <http://www.gnu.org/licenses/>.           #
//###############################################################################
//# Version History:                                                            #
//#   August 10, 2018                                                           #
//#      - Initial release                                                      #
//###############################################################################

== WbXbc Arbiter

[ditaa, WbXbc_arbiter, svg]
....
              +-------------------+           
          --->|                   |           
              |                   |           
 Multiple --->|      WbXbc        |     One 
 Initiator    |      Arbiter      +---> Target
 Busses    ...|                   |     Bus 
              |                   |           
          --->|                   |           
              +-------------------+           
....

This module implements a bus arbiter for the pipelined Wishbone        
protocol. Accesses from multiple initiator busses are arbitrated and   
propagated to the target bus. Each initiator bus can request bus       
accesses at two priority levels. The priority levels are selected via a
set of address tags. Access requests of equal priority are arbitrated  
with a fixed priority (initiator 0 has the higheest priority).         

=== Integration Parameters
[cols="30,20,50",options="header"]
|=====================================================
|Parameter   |Default Value |Description
|ITR_CNT    >|4             |number of initiator busses
|ADDR_WIDTH >|16            |width of the address bus
|DATA_WIDTH >|16            |width of each data bus
|SEL_WIDTH  >|2             |number of write data select lines
|TGA_WIDTH  >|1             |number of address tags
|TGC_WIDTH  >|1             |number of cycle tags
|TGRD_WIDTH >|1             |number of read data tags
|TGWD_WIDTH >|1             |number of write data tags
|=====================================================

Section <<parameters>> gives a detailed description of each parameter listed above.

=== Interface Signals
[cols="20,35,15,30v",options="header"]
|=====================================================
|Signal   |Range |Direction |Description
4+h|Clock and Reset
|clk_i             >|                         |input  |module clock	
|async_rst_i       >|                         |input  |asynchronous reset	
|sync_rst_i        >|                         |input  |synchronous reset  
4+h|Initiator Interface
|itr_cyc_i         >|ITR_CNT-1:0              |input  |concatinated bus cycle indicators
|itr_stb_i         >|ITR_CNT-1:0              |input  |concatinated access requests
|itr_we_i          >|ITR_CNT-1:0              |input  |concatinated write enables
|itr_lock_i        >|ITR_CNT-1:0              |input  |concatinated bus cycle locks
|itr_sel_i         >|(ITR_CNT*SEL_WIDTH)-1:0  |input  |concatinated write data selects
|itr_adr_i         >|(ITR_CNT*ADDR_WIDTH)-1:0 |input  |concatinated address busses
|itr_dat_i         >|(ITR_CNT*DATA_WIDTH)-1:0 |input  |concatinated write data busses
|itr_tga_i         >|(ITR_CNT*TGA_WIDTH)-1:0  |input  |concatinated address tags
|itr_tga_prio_i    >|ITR_CNT-1:0              |input  |concatinated access priorities
|itr_tgc_i         >|(ITR_CNT*TGC_WIDTH)-1:0  |input  |concatinated bus cycle tags
|itr_tgd_i         >|(ITR_CNT*TGWD_WIDTH)-1:0 |input  |concatinated write data tags
|itr_ack_o         >|ITR_CNT-1:0              |output |concatinated bus cycle acknowledges
|itr_err_o         >|ITR_CNT-1:0              |output |concatinated error indicators
|itr_rty_o         >|ITR_CNT-1:0              |output |concatinated retry requests
|itr_stall_o       >|ITR_CNT-1:0              |output |concatinated access delays
|itr_dat_o         >|(ITR_CNT*DATA_WIDTH)-1:0 |output |concatinated read data buses
|itr_tgd_o         >|(ITR_CNT*TGRD_WIDTH)-1:0 |output |concatinated read data tags
4+h|Target Interface
|tgt_cyc_o         >|                         |output |bus cycle indicator
|tgt_stb_o         >|                         |output |access request
|tgt_we_o          >|                         |output |write enable
|tgt_lock_o        >|                         |output |uninterruptable bus cycle
|tgt_sel_o         >|SEL_WIDTH-1:0            |output |write data selects
|tgt_adr_o         >|ADDR_WIDTH-1:0           |output |write data selects
|tgt_dat_o         >|DATA_WIDTH-1:0           |output |write data bus
|tgt_tga_o         >|TGA_WIDTH-1:0            |output |address tags
|tgt_tgc_o         >|TGC_WIDTH-1:0            |output |bus cycle tags
|tgt_tgd_o         >|TGWD_WIDTH-1:0           |output |write data tags
|tgt_ack_i         >|                         |input  |bus cycle acknowledge
|tgt_err_i         >|                         |input  |error indicator
|tgt_rty_i         >|                         |input  |retry request
|tgt_stall_i       >|                         |input  |access delay
|tgt_dat_i         >|DATA_WIDTH-1:0           |input  |read data bus
|tgt_tgd_i         >|TGRD_WIDTH-1:0           |input  |read data tags
|=====================================================

Section <<signals>> gives a detailed description of each slignal listed above.

=== Verification Status
[cols="16v,>4,4*20v",options="header"]
|=====================================================
2+<|Configuration <|Linting <|Simulation <|Formal <|FPGA
//Default configuration
6+h|Default Configuration
|ITR_CNT    >|4
//Liniting
.8+^.^| iVerilog,
Yosys
//Simulation
.8+^.^|
//Formal
.8+^.^|
//FPGA
.8+^.^|          
|ADDR_WIDTH >|16            
|DATA_WIDTH >|16             
|SEL_WIDTH  >|2             
|TGA_WIDTH  >|1             
|TGC_WIDTH  >|1             
|TGRD_WIDTH >|1             
|TGWD_WIDTH >|1             
|=====================================================

All lint checks have been done with the Icarus Verilog simulator cite:[IVerilog]
and the Yosys synthesis tool cite:[Yosys].

